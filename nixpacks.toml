[phases.setup]
nixPkgs = ["dotnet-sdk_8"]

[phases.install]
cmds = [
  "PROJ_DIR=$(find . -name 'Travel.Api.csproj' -type f | head -1 | xargs dirname) && cd \"$PROJ_DIR\" && dotnet restore"
]

[phases.build]
cmds = [
  "PROJ_DIR=$(find . -name 'Travel.Api.csproj' -type f | head -1 | xargs dirname) && cd \"$PROJ_DIR\" && dotnet publish -c Release -o ../../out || (cd \"$PROJ_DIR\" && dotnet publish -c Release -o ../out)"
]

[start]
cmd = "if [ -d out ]; then cd out && dotnet Travel.Api.dll; else PROJ_DIR=$(find . -name 'Travel.Api.dll' -type f | head -1 | xargs dirname) && cd \"$PROJ_DIR\" && dotnet Travel.Api.dll; fi"
